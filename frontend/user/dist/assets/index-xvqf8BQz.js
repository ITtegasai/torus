import{r as o,W as Y,u as z,b as $,d as G,j as e,e as O,I as N,M as j,B as r,g as U,f as d,h as K,s as Q}from"./index-CxNXazyc.js";import{B as p,d as X,C as Z}from"./dayjs.min-qh1UZGPb.js";import{L as ee,E as te,J as se}from"./loadFileAsBase64-DR4lHEua.js";import{I as ie}from"./ImageLoader-DdenBJX_.js";import{r as ne,q as oe}from"./qr_ecliptics-B3hpk3-U.js";import"./CustomCheckbox-vyuK3Mg2.js";const ae="_container_12tki_1",ce="_topBlock_12tki_6",le="_buyStocks_12tki_17",re="_dividend_12tki_33",de="_dividendTitle_12tki_49",me="_dividendCount_12tki_56",_e="_stocks_12tki_66",ue="_stocksHeader_12tki_83",he="_stocksRemained_12tki_102",ke="_stocksBought_12tki_108",xe="_stocksPrice_12tki_122",fe="_stocksChart_12tki_151",je="_stocksChartLine_12tki_158",pe="_table_12tki_164",ge="_tableTitle_12tki_175",be="_tableTable_12tki_182",ve="_tableSum_12tki_221",Ce="_file_12tki_227",ye="_modal_12tki_241",Ne="_modalTitle_12tki_247",Fe="_modalContainer_12tki_255",Be="_twoFields_12tki_263",Re="_modalImageLoader_12tki_271",Se="_doc_12tki_278",Te="_actionBtns_12tki_283",we="_docModal_12tki_294",Le="_needVerification_12tki_302",Pe="_needVerification__title_12tki_309",Ve="_needVerification__descr_12tki_314",s={container:ae,topBlock:ce,buyStocks:le,dividend:re,dividendTitle:de,dividendCount:me,stocks:_e,stocksHeader:ue,stocksRemained:he,stocksBought:ke,stocksPrice:xe,stocksChart:fe,stocksChartLine:je,table:pe,tableTitle:ge,tableTable:be,tableSum:ve,file:Ce,modal:ye,modalTitle:Ne,modalContainer:Fe,twoFields:Be,modalImageLoader:Re,doc:Se,actionBtns:Te,docModal:we,needVerification:Le,needVerification__title:Pe,needVerification__descr:Ve},L="/assets/banner1-Dgf4Pc6d.jpg",P="/assets/banner2-C56fcPWq.jpg",Ie=await ee(se);function Je(){const[V,c]=o.useState(!1),[F,g]=o.useState(null),{main:a,user:I}=o.useContext(Y),M=z(),[D,E]=o.useState(""),h=o.useRef(null),b=o.useRef(null),k=o.useRef(null),B=o.useRef(null),v=o.useRef(null),R=o.useRef(""),l=o.useRef({}),[A]=$(["access_token"]),C=A?.access_token,m=20,_=a?.count||0,S=()=>{g(null),B?.current?.clear()},T=[...ne,{label:"Сумма",text:new Intl.NumberFormat("ru-RU").format(l.current.showingSumm)}],H=()=>{const t=new te,i=t.internal.pageSize.height;t.addFileToVFS("Jost-400.ttf",Ie),t.addFont("Jost-400.ttf","Jost","normal"),t.setFont("Jost","normal");const u=10;let f=10,n=u;const y=10;T.forEach(w=>{n>i-y&&(t.addPage(),n=u),n+=y,t.setFontSize(12),t.text(w.label,f,n),n+=y,t.setFontSize(14),t.text(w.text,f,n-3)}),t.save("requisits.pdf")},x=async(t,i,u,f)=>{if(I?.role<1){v.current.open();return}try{c(!0);const n=await U(C,t,i,u,2);k?.current?.open(),l.current={summ:t,count:i,type:u,showingSumm:f},E(n?.dogovor)}catch(n){if(n.status===403){d.error("Покупка акции доступна только верифицированным пользователям");return}d.error(n?.response?.data.detail||"Произошла ошибка, попробуйте снова")}finally{c(!1)}},q=async()=>{try{k?.current?.close(),c(!0);const t=await K(C,l.current.summ,l.current.count,l.current.type,2);h?.current?.open(),R.current=t.hash}catch(t){if(console.log(t),t.status===403){d.error("Покупка акции доступна только верифицированным пользователям");return}if(t.status===408){d.error("Подтвердите оплату или отмените инвойс");return}d.error("Произошла ошибка, попробуйте снова")}finally{c(!1)}},J=()=>{h?.current?.close(),b?.current?.open()},W=async()=>{try{c(!0);const t=new FormData;t.append("receipt",F),await Q(C,R?.current,t),b?.current?.close(!1),d.success("Уже проверяем Вашу оплату"),l.current={},S()}catch(t){console.log(t)}finally{c(!1)}};return G("Main"),e.jsxs(e.Fragment,{children:[V&&e.jsx(O,{}),e.jsxs("div",{className:s.container,children:[e.jsxs("div",{className:s.topBlock,children:[e.jsxs("div",{className:s.dividend,children:[e.jsx("h5",{className:s.dividendTitle,children:"Выплаченно бонусов"}),e.jsxs("div",{className:s.dividendCount,children:[e.jsxs("p",{children:[a?.dividend||0," ₽"]}),e.jsx(N,{width:24,name:"monets",style:{color:"#8FE8A3"}})]})]}),e.jsxs("div",{className:s.dividend,children:[e.jsx("h5",{className:s.dividendTitle,children:"Стоимость СФО* на одну акцию"}),e.jsxs("div",{className:s.dividendCount,children:[e.jsxs("p",{children:[a?.current_price||0," ₽"]}),e.jsx(N,{width:24,name:"monets",style:{color:"#8FE8A3"}})]}),e.jsx("p",{style:{marginTop:"10px",color:"#8e8e8e",letterSpacing:"-0.01rem"},children:"*Совокупные финансовые обязательства на одну акцию"})]}),e.jsxs("div",{className:s.dividend,children:[e.jsx("h5",{className:s.dividendTitle,children:"Баланс"}),e.jsx("div",{style:{display:"flex",flexDirection:"row",justifyContent:"space-between",alignItems:"flex-start"},children:e.jsxs("div",{className:s.dividendCount,children:[e.jsxs("p",{children:[a?.balance," ₽"]}),e.jsx(N,{width:24,name:"monets",style:{color:"#8FE8A3"}})]})})]}),e.jsxs("div",{className:s.stocks,children:[e.jsx("div",{className:s.stocksHeader,children:e.jsx("div",{className:s.stocksRemained,children:_>=m?"Акционер":"Осталось до акционера"})}),e.jsxs("div",{className:s.stocksBought,children:["Куплено акций ",e.jsx("span",{children:_}),_<m&&e.jsxs("span",{children:["/",m]})]}),e.jsx("div",{className:s.stocksChart,children:e.jsx("div",{style:{width:`${Math.min(_/m*100,100)}%`},className:s.stocksChartLine})})]})]}),e.jsxs("div",{className:s.buyStocks,children:[_<m?e.jsx(p,{title:"Поштучно",smallTitle:"Покупка акций поштучно",label:"Кол-во акций",bgSrc:L,min:1,onClick:(t,i)=>x(t,i,0,t*a?.current_price),backgroundColor:"#3FF6BF",green:!0}):e.jsx(p,{title:"На указанную сумму",smallTitle:"Покупка акций на указанную сумму",label:"Сумма",bgSrc:L,min:0,isAgreement:!1,onClick:(t,i)=>x(i,t,0,t),backgroundColor:"#3FF6BF",green:!0}),a?.fix_timestamp?e.jsx(p,{title:"Рассрочка",smallTitle:`Рассрочка до ${X(a?.fix_timestamp*1e3).format("DD.MM.YYYY")}`,label:"Сумма",bgSrc:P,buttonLabel:"Оплатить",min:1,isAgreement:!1,onClick:(t,i)=>x(i,t,3,t),backgroundColor:"#59F2BB",green:!0}):e.jsx(p,{title:"Рассрочка",smallTitle:"Рассрочка",label:"Кол-во акций",bgSrc:P,buttonLabel:"Взять в рассрочку",min:10,onClick:(t,i)=>x(t,i,3,t*a?.current_price),backgroundColor:"#59F2BB",green:!0})]})]}),e.jsx(j,{onClose:S,modalRef:h,children:e.jsxs("div",{className:s.modal,children:[e.jsx("h5",{className:s.modalTitle,children:"Реквизиты для оплаты"}),e.jsx("div",{style:{maxWidth:"50%",margin:"0 auto"},children:e.jsx("img",{src:oe,style:{width:"100%",height:"auto"}})}),e.jsxs("div",{className:s.modalContainer,children:[T.map((t,i)=>e.jsx(Z,{label:t.label,text:t.text},i)),e.jsx(r,{onClick:J,type:"primary",children:"Я оплатил"}),e.jsx("button",{onClick:H,children:"Скачать PDF с реквизитами"})]})]})}),e.jsx(j,{onClose:()=>h?.current?.open(),modalRef:b,children:e.jsxs("div",{className:s.modal,children:[e.jsx("h5",{className:s.modalTitle,children:"Прикрепите чек оплаты"}),e.jsxs("div",{className:s.modalContainer,children:[e.jsx("div",{className:s.modalImageLoader,children:e.jsx(ie,{onClear:()=>g(null),loaderRef:B,setFile:g})}),e.jsx(r,{disabled:!F,onClick:W,type:"primary",children:"Подтвердить оплату"})]})]})}),e.jsx(j,{big:!0,modalRef:k,children:e.jsxs("div",{className:s.docModal,children:[e.jsx("div",{className:s.doc,dangerouslySetInnerHTML:{__html:D}}),e.jsxs("div",{className:s.actionBtns,children:[e.jsx(r,{onClick:q,children:"Согласен"}),e.jsx(r,{onClick:()=>k?.current?.close(),type:"outlined",children:"Отмена"})]})]})}),e.jsx(j,{modalRef:v,children:e.jsxs("div",{className:s.needVerification,children:[e.jsx("h5",{className:s.needVerification__title,children:"Пройдите верификацию"}),e.jsx("p",{className:s.needVerification__descr,children:"Перед покупкой необходимо пройти верификацию"}),e.jsx(r,{onClick:()=>M("/profile/verification"),children:"Пройти"}),e.jsx(r,{onClick:()=>v?.current?.close(),type:"outlined",children:"Отмена"})]})})]})}export{Je as default};
