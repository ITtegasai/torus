import{r as c,n as R,b as U,l as V,u as D,j as s,m as _,L as h,B as I,o as x,e as P,p as q,f as z,q as k}from"./index-CxNXazyc.js";import{C as A}from"./CustomCheckbox-vyuK3Mg2.js";import{a as F}from"./verificationCode-ByXnRRt0.js";const G="_description_15wbv_1",H="_container_15wbv_6",J="_form_15wbv_12",K="_link_15wbv_18",O="_control_15wbv_24",Q="_footer_15wbv_31",t={description:G,container:H,form:J,link:K,control:O,footer:Q};function $(){const[T,w]=c.useContext(R),[l,d,i]=U(["rememberMe"]),j=V(),u=D(),[g,o]=c.useState(!1),v=j.state?.email||l?.rememberMe?.mail,M=l.rememberMe?.pass,[p,m]=c.useState(!!l?.rememberMe),[r,C]=c.useState(v??""),[n,y]=c.useState(M??""),L=()=>{p?i("rememberMe"):d("rememberMe",{mail:r,pass:n}),m(a=>!a)},N=a=>{C(a),m(e=>e&&(i("rememberMe"),!1))},E=a=>{y(a),m(e=>e&&(i("rememberMe"),!1)),i("rememberMe")},S=async a=>{a.preventDefault(),o(!0);try{const e=await x({email:r,password:n}),f=await q({access_token:e.access_token});w(f.result),d("access_token",e.access_token,{path:"/"}),u("/main",{replace:!0}),o(!1)}catch(e){if(e?.response?.data?.detail?.error==="User not verified"){await B(r,n,e.response.data.detail.access_token);return}z.error(k(e)),o(!1)}},B=async(a,e,f)=>{try{o(!0),(await F(a)).result==="ok"&&u("/email-confirmation",{state:{email:a,password:e}})}catch(b){alert(k(b))}finally{o(!1)}};return s.jsxs("div",{className:t.container,children:[s.jsx("div",{className:t.description}),s.jsxs("form",{onSubmit:S,className:t.form,children:[s.jsx(_,{value:r,setValue:N,label:"Email",placeholder:"Введите e-mail",type:"email",autoComplete:"username"}),s.jsx(_,{value:n,setValue:E,label:"Пароль",placeholder:"Введите пароль",type:"password",autoComplete:"current-password"}),s.jsxs("div",{className:t.control,children:[s.jsx(A,{label:"Запомнить меня",checked:p,onChange:L}),s.jsx(h,{className:t.link,to:"/forgot-password",state:{email:r},children:"Не помню пароль"})]}),s.jsx(I,{disabled:!n.length||!x.length,type:"primary",children:"Войти"})]}),s.jsxs("div",{className:t.footer,children:[s.jsx("p",{children:"Нет аккаунта?"}),s.jsx(h,{className:t.link,to:"/sign-up",children:"Регистрация"})]}),g&&s.jsx(P,{})]})}export{$ as default};
