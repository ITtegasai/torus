import{u as z,j as e,c as g,B as v,r as l,W as G,b as w,d as B,z as T,A as W,f as V,e as O,m as n}from"./index-CxNXazyc.js";import{T as U}from"./Tabs-CMzsi51Z.js";import{s as a}from"./Profile.module-BEE_HuUs.js";import{I as $}from"./ImageLoader-DdenBJX_.js";const A="_verification_mz074_1",H="_verificationClosed_mz074_26",R="_description_mz074_30",J="_btnGroup_mz074_42",f={verification:A,verificationClosed:H,description:R,btnGroup:J};function K({isVisible:d,setVisible:u}){const c=z();return e.jsxs("div",{className:g(f.verification,{[f.verificationClosed]:!d}),children:[e.jsx("p",{className:f.description,children:"Пройдите верификацию в личном кабинете"}),e.jsxs("div",{className:f.btnGroup,children:[e.jsx(v,{onClick:()=>c("/profile/verification"),type:"outlined",children:"Пройти сейчас"}),e.jsx(v,{onClick:()=>u(!1),type:"secondary",children:"Пройти позже"})]})]})}const M=()=>{const[d,u]=l.useState(!0),[c,i]=l.useState(null),[x,p]=l.useState(!1),[r,h]=l.useState({}),[j,o]=l.useState({}),{user:s}=l.useContext(G),[C]=w(["access_token"]),b=C?.access_token,[_,N]=l.useState(!1),[k,F]=l.useState({first_name:"",phone:"",birthday:"",city:"",profession:"",telegram:"",education:"",registration:"",passport_number:"",passport_date:"",username:"",email:""}),S=s?`https://main.toruscrm.pro/images/${s.uid}.jpg`:null;B("User"),l.useEffect(()=>{if(s){const t={first_name:s.first_name||"",phone:s.phone||"",birthday:s.birthday||"",city:s.city||"",profession:s.profession||"",telegram:s.telegram||"",passport_date:s.passport_date||"",passport_number:s.passport_number||"",registration:s.registration||"",education:s.education||"",username:s.username||"",email:s.email||""};o(t),F(t)}},[s]);const y=Object.keys(r).length>0||_,q=async()=>{try{if(p(!0),_){const t=new FormData;t.append("image",c),await T(b,t)}y&&await W(b,"user_data",r),h({}),N(!1),V.success("Данные успешно сохранены")}catch(t){console.log(t),V.error("Ошибка, проверьте Интернет соединение и попробуйте еще раз")}finally{p(!1)}},P=t=>{i(t),N(c!==t)};return l.useEffect(()=>{},[]),{visible:d,setVisible:u,image:c,isLoading:x,hasChanged:y,formData:k,onSave:q,changePhoto:P,changeField:(t,m)=>{F(D=>{const E=t!==j[m];return h(L=>{if(E)return{...L,[m]:t};{const{[m]:Y,...I}=L;return I}}),{...D,[m]:t}})},userPhoto:S,user:s}},Q=[{link:null,title:"Личные данные"},{link:"/profile/verification",title:"Верификация"}];function ie(){const{visible:d,setVisible:u,isLoading:c,formData:i,onSave:x,changePhoto:p,changeField:r,userPhoto:h,hasChanged:j,user:o}=M();return e.jsxs(e.Fragment,{children:[c&&e.jsx(O,{}),e.jsxs("div",{className:g(a.container,{[a.container__noGap]:o&&o.role>0}),children:[e.jsxs("div",{className:g(a.header,{[a.verificationClosed]:!d,[a.notVerificatedHeader]:o&&o.role}),children:[e.jsx(U,{tabs:Q}),o&&o.role<1&&e.jsx("div",{className:a.verification,children:e.jsx(K,{isVisible:d,setVisible:u})})]}),e.jsxs("div",{className:a.main,children:[e.jsxs("div",{className:a.info,children:[e.jsx("h4",{className:a.title,children:"Основная информация"}),e.jsxs("div",{className:a.infoFields,children:[e.jsxs("p",{className:a.infoFieldsLabel,children:["ФИО",e.jsx("span",{children:"*"})]}),e.jsx(n,{setValue:s=>r(s,"first_name"),value:i.first_name,require:!0,placeholder:"Введите ФИО"}),e.jsxs("p",{className:a.infoFieldsLabel,children:["Логин",e.jsx("span",{children:"*"})]}),e.jsx(n,{disabled:!0,isLocked:!0,setValue:()=>{},value:i.username,require:!0,placeholder:"Введите логин"}),e.jsxs("p",{className:a.infoFieldsLabel,children:["День рождения",e.jsx("span",{children:"*"})]}),e.jsx(n,{setValue:s=>r(s,"birthday"),value:i.birthday,require:!0,type:"date",placeholder:"Выберите дату"}),e.jsxs("p",{className:a.infoFieldsLabel,children:["Город проживания",e.jsx("span",{children:"*"})]}),e.jsx(n,{setValue:s=>r(s,"city"),value:i.city,require:!0,placeholder:"Введите город проживания"}),e.jsx("p",{className:a.infoFieldsLabel,children:"Род деятельности"}),e.jsx(n,{setValue:s=>r(s,"profession"),value:i.profession,placeholder:"Введите род деятельности"}),e.jsx("p",{className:a.infoFieldsLabel,children:"Образование"}),e.jsx(n,{setValue:s=>r(s,"education"),value:i.education,placeholder:"Введите образование"}),e.jsxs("p",{className:a.infoFieldsLabel,children:["№ паспорта",e.jsx("span",{children:"*"})]}),e.jsx(n,{setValue:s=>r(s,"passport_number"),value:i.passport_number,require:!0,placeholder:"№"}),e.jsxs("p",{className:a.infoFieldsLabel,children:["Дата выдачи",e.jsx("span",{children:"*"})]}),e.jsx(n,{require:!0,setValue:s=>r(s,"passport_date"),value:i.passport_date,type:"date",placeholder:"Выберите дату"}),e.jsxs("p",{className:a.infoFieldsLabel,children:["Прописка",e.jsx("span",{children:"*"})]}),e.jsx(n,{setValue:s=>r(s,"registration"),value:i.registration,require:!0,placeholder:"Введите адрес прописки"})]})]}),e.jsxs("div",{className:a.info,children:[e.jsx("h4",{className:a.title,children:"Фотография"}),e.jsx($,{setFile:p,imgUrl:h})]}),e.jsxs("div",{children:[e.jsx("h4",{className:a.title,children:"Контакты"}),e.jsxs("div",{className:a.infoFields,children:[e.jsx("p",{className:a.infoFieldsLabel,children:"Email"}),e.jsx(n,{value:i.email,disabled:!0,isLocked:!0,placeholder:"Введите Email"}),e.jsxs("p",{className:a.infoFieldsLabel,children:["Телефон",e.jsx("span",{children:"*"})]}),e.jsx(n,{require:!0,type:"tel",value:i.phone,setValue:s=>r(s,"phone"),placeholder:"Введите телефон"}),e.jsxs("p",{className:a.infoFieldsLabel,children:["Whatsapp/Telegram",e.jsx("span",{children:"*"})]}),e.jsx(n,{setValue:s=>r(s,"telegram"),value:i.telegram,require:!0,placeholder:"Введите Whatsapp/Telegram"})]})]})]}),e.jsx("div",{className:a.endBtn,children:e.jsx(v,{disabled:!j,onClick:x,children:"Сохранить"})})]})]})}export{ie as default};
