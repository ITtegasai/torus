import{r as n,W as P,b as R,d as E,j as s,e as G,B as c,I as y,M as V,f as h,w as L}from"./index-CxNXazyc.js";import{s as e,I as _,T as M,u as $}from"./ReactSlider-D3tcLCcN.js";import{T as D}from"./Tabs-CMzsi51Z.js";import{u as W}from"./useWSSend-BU2iH3ii.js";import"./Pagination-C43MfAmQ.js";const A=["Дата","Инициатор","Уровень","Тип","Статус","Сумма, баллы"],N=[{title:"Создана",class:e.statusCreated},{title:"На проверке",class:e.statusChecking},{title:"Отклонена",class:e.statusRejected},{title:"Оплачена",class:e.statusPayed}],H=[{link:"/finances",title:"Список счетов"},{link:null,title:"Бонусы"}];function O(){const{bonuses:a,isReady:b}=n.useContext(P),[v]=R(["access_token"]),g=v?.access_token,[k,j]=n.useState(!1),d=n.useRef(null),[B,f]=n.useState(!1),[r,C]=n.useState([]),[u,p]=n.useState({amount_min:0,amount_max:0}),[o,T]=n.useState({min:0,max:0}),w=W();n.useEffect(()=>{a&&(f(!1),T({min:a.min_amount,max:a.max_amount}))},[a]),n.useEffect(()=>{a&&p({amount_min:a.min_amount,amount_max:a.max_amount})},[a?.amount_max]),n.useEffect(()=>{a?.amount_max>0&&m(0)},[u]),E("Bonuses",{tx_type:0,limit:10,offset:0,filter:""});const m=(t=0,i=u.amount_min,l=u.amount_max)=>{f(!0),w("Bonuses",{tx_type:0,limit:10,offset:t*10,filter:l?`amount >= ${i} and amount <= ${l}`:""})},S=()=>{d.current.close(),p(t=>({...t,amount_min:r[0],amount_max:r[1]})),m(0,r[0],r[1])},I=async()=>{if(!a?.available_receipt){h.error("Не удалось вывести бонусы");return}try{j(!0);const t=await L(g,0);console.log(t),h.success("Запрос на вывод успешно отправлен")}catch(t){console.log(t),h.error("Не удалось вывести бонусы")}finally{j(!1)}};return s.jsxs(s.Fragment,{children:[(b&&!a||B)&&s.jsx(G,{}),s.jsxs("div",{className:e.container,children:[s.jsxs("div",{className:e.header,children:[s.jsx(D,{tabs:H}),s.jsxs("div",{className:e.buttons,children:[s.jsx(c,{onClick:()=>d?.current?.open(),type:"secondary",children:s.jsx(y,{name:"filter",width:21})}),s.jsx(c,{type:"secondary",children:s.jsx(y,{name:"download",width:21})})]})]}),s.jsxs("div",{className:e.financesInfo,children:[s.jsxs("div",{className:e.infoTabs,children:[s.jsx(_,{text:["Всего начисленных бонусов:",a?.all_bonuses]}),s.jsx(_,{text:["Бонусов в ожидании:",a?.in_waiting]}),s.jsx(_,{text:["Отклоненные:",a?.rejected]})]}),s.jsxs("div",{className:e.readyToGet,children:[s.jsxs("div",{className:e.readyToGet__leftPart,children:[s.jsx("p",{className:e.readyToGet__title,children:"Доступно к получению"}),s.jsxs("p",{className:e.readyToGet__sum,children:[a?.available_receipt||0," балл"]})]}),s.jsx(c,{disabled:k||!a?.available_receipt,onClick:I,variant:"secondary",children:"Получить"})]})]}),s.jsxs("div",{className:e.table,children:[s.jsx("h4",{className:e.tableTitle,children:"Список счетов"}),s.jsx(M,{onChangePage:t=>m(t),count:a?.count||0,pagination:!0,totalData:a?.transactions||[],header:A,rowItem:(t,i)=>s.jsxs("tr",{children:[s.jsx("td",{children:t.create_at}),s.jsx("td",{children:t.initiator_id}),s.jsx("td",{children:t.initiator_level}),s.jsx("td",{children:a?.bonus_types[t.bonus_type]}),s.jsx("td",{children:s.jsxs("p",{className:N[t.status].class,children:[s.jsx("span",{}),N[t.status].title]})}),s.jsx("td",{children:t.amount})]},i)})]})]}),s.jsx(V,{modalRef:d,position:"right",children:s.jsxs("div",{className:e.filterModalContainer,children:[s.jsx("h4",{className:e.filterModal__title,children:"Настройка фильтра"}),o.max&&s.jsx($,{className:e.slider,thumbClassName:e.slider__thumb,trackClassName:e.slider__track,defaultValue:[o.min,o.max],min:o.min,max:o.max,step:1,onChange:t=>C(t),renderThumb:(t,i)=>{const{key:l,...x}=t;return s.jsx("div",{...x,children:s.jsx("div",{className:e.slider__label,children:i.valueNow})},l)},renderTrack:(t,i)=>{const l=i.index,{key:x,...F}=t;return s.jsx("div",{...F,className:`${e.slider__track} ${l===1?e.slider__trackBetween:""}`},x)}}),s.jsx("div",{className:e.useFilterBtn,children:s.jsx(c,{onClick:S,children:"Применить"})})]})})]})}const U=n.memo(O);export{U as default};
