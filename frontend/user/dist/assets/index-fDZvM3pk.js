import{r as o,W,u as z,b as $,d as G,j as e,e as O,I as y,M as f,B as r,g as U,f as d,h as K,s as Q}from"./index-CxNXazyc.js";import{B as j,d as X,C as Z}from"./dayjs.min-qh1UZGPb.js";import{L as ee,E as se,J as te}from"./loadFileAsBase64-DR4lHEua.js";import{I as ie}from"./ImageLoader-DdenBJX_.js";import{r as ne,q as oe}from"./qr_torus-uy8TiILN.js";import"./CustomCheckbox-vyuK3Mg2.js";const ae="_container_gixsg_1",ce="_topBlock_gixsg_6",le="_buyStocks_gixsg_17",re="_dividend_gixsg_33",de="_dividendTitle_gixsg_49",me="_dividendCount_gixsg_56",_e="_stocks_gixsg_66",xe="_stocksHeader_gixsg_83",ge="_stocksRemained_gixsg_102",ue="_stocksBought_gixsg_108",he="_stocksPrice_gixsg_122",fe="_stocksChart_gixsg_151",je="_stocksChartLine_gixsg_158",pe="_table_gixsg_164",ke="_tableTitle_gixsg_175",ve="_tableTable_gixsg_182",be="_tableSum_gixsg_221",Ce="_file_gixsg_227",ye="_modal_gixsg_241",Ne="_modalTitle_gixsg_247",Re="_modalContainer_gixsg_255",Se="_twoFields_gixsg_263",Te="_modalImageLoader_gixsg_271",Be="_doc_gixsg_278",we="_actionBtns_gixsg_283",Le="_docModal_gixsg_294",Fe="_needVerification_gixsg_302",Ve="_needVerification__title_gixsg_309",Pe="_needVerification__descr_gixsg_314",t={container:ae,topBlock:ce,buyStocks:le,dividend:re,dividendTitle:de,dividendCount:me,stocks:_e,stocksHeader:xe,stocksRemained:ge,stocksBought:ue,stocksPrice:he,stocksChart:fe,stocksChartLine:je,table:pe,tableTitle:ke,tableTable:ve,tableSum:be,file:Ce,modal:ye,modalTitle:Ne,modalContainer:Re,twoFields:Se,modalImageLoader:Te,doc:Be,actionBtns:we,docModal:Le,needVerification:Fe,needVerification__title:Ve,needVerification__descr:Pe},F="/assets/paper-D00giLl7.png",V="/assets/coins-Dd0wkcR_.png",De=await ee(te);function Ye(){const[P,c]=o.useState(!1),[N,p]=o.useState(null),{cabinet:a,user:D}=o.useContext(W),I=z(),[M,H]=o.useState(""),x=o.useRef(null),k=o.useRef(null),g=o.useRef(null),R=o.useRef(null),v=o.useRef(null),S=o.useRef(""),l=o.useRef({}),[J]=$(["access_token"]),b=J?.access_token,T=10,m=a?.count||0,B=()=>{p(null),R?.current?.clear()},w=[...ne,{label:"Сумма",text:new Intl.NumberFormat("ru-RU").format(l.current.showingSumm)}],q=()=>{const s=new se,i=s.internal.pageSize.height;s.addFileToVFS("Jost-400.ttf",De),s.addFont("Jost-400.ttf","Jost","normal"),s.setFont("Jost","normal");const _=10;let h=10,n=_;const C=10;w.forEach(L=>{n>i-C&&(s.addPage(),n=_),n+=C,s.setFontSize(12),s.text(L.label,h,n),n+=C,s.setFontSize(14),s.text(L.text,h,n-3)}),s.save("requisits.pdf")},u=async(s,i,_,h)=>{if(D?.role<1){v.current.open();return}try{c(!0);const n=await U(b,s,i,_);g?.current?.open(),l.current={summ:s,count:i,type:_,showingSumm:h},H(n?.dogovor)}catch(n){if(n.status===403){d.error("Покупка акции доступна только верифицированным пользователям");return}d.error(n?.response?.data.detail||"Произошла ошибка, попробуйте снова")}finally{c(!1)}},E=async()=>{try{g?.current?.close(),c(!0);const s=await K(b,l.current.summ,l.current.count,l.current.type);x?.current?.open(),S.current=s.hash}catch(s){if(console.log(s),s.status===403){d.error("Покупка акции доступна только верифицированным пользователям");return}if(s.status===408){d.error("Подтвердите оплату или отмените инвойс");return}d.error("Произошла ошибка, попробуйте снова")}finally{c(!1)}},Y=()=>{x?.current?.close(),k?.current?.open()},A=async()=>{try{c(!0);const s=new FormData;s.append("receipt",N),await Q(b,S?.current,s),k?.current?.close(!1),d.success("Уже проверяем Вашу оплату"),l.current={},B()}catch(s){console.log(s)}finally{c(!1)}};return G("Cabinet"),e.jsxs(e.Fragment,{children:[P&&e.jsx(O,{}),e.jsxs("div",{className:t.container,children:[e.jsxs("div",{className:t.topBlock,children:[e.jsxs("div",{className:t.dividend,children:[e.jsx("h5",{className:t.dividendTitle,children:"Выплаченно бонусов"}),e.jsxs("div",{className:t.dividendCount,children:[e.jsxs("p",{children:[a?.dividend||0," ₽"]}),e.jsx(y,{width:24,name:"monets",style:{color:"var(--color-accent)"}})]})]}),e.jsxs("div",{className:t.dividend,children:[e.jsx("h5",{className:t.dividendTitle,children:"Стоимость СФО* на одну акцию"}),e.jsxs("div",{className:t.dividendCount,children:[e.jsxs("p",{children:[a?.current_price||0," ₽"]}),e.jsx(y,{width:24,name:"monets",style:{color:"var(--color-accent)"}})]}),e.jsx("p",{style:{marginTop:"10px",color:"#8e8e8e",letterSpacing:"-0.01rem"},children:"*Совокупные финансовые обязательства на одну акцию"})]}),e.jsxs("div",{className:t.dividend,children:[e.jsx("h5",{className:t.dividendTitle,children:"Баланс"}),e.jsx("div",{style:{display:"flex",flexDirection:"row",justifyContent:"space-between",alignItems:"flex-start"},children:e.jsxs("div",{className:t.dividendCount,children:[e.jsxs("p",{children:[a?.balance," ₽"]}),e.jsx(y,{width:24,name:"monets",style:{color:"var(--color-accent)"}})]})})]}),e.jsxs("div",{className:t.stocks,children:[e.jsx("div",{className:t.stocksHeader,children:e.jsx("div",{className:t.stocksRemained,children:m>=10?"Акционер":"Осталось до акционера"})}),e.jsxs("div",{className:t.stocksBought,children:["Куплено акций ",e.jsx("span",{children:m}),m<10&&e.jsxs("span",{children:["/",T]})]}),e.jsx("div",{className:t.stocksChart,children:e.jsx("div",{style:{width:`${Math.min(m/T*100,100)}%`},className:t.stocksChartLine})})]})]}),e.jsxs("div",{className:t.buyStocks,children:[m<10?e.jsx(j,{title:"Поштучно",smallTitle:"Покупка акций поштучно",label:"Кол-во акций",bgSrc:F,min:1,onClick:(s,i)=>u(s,i,0,s*a?.current_price)}):e.jsx(j,{title:"На указанную сумму",smallTitle:"Покупка акций на указанную сумму",label:"Сумма",bgSrc:F,min:0,onClick:(s,i)=>u(i,s,0,s)}),a?.fix_timestamp?e.jsx(j,{title:"Рассрочка",smallTitle:`Рассрочка до ${X(a?.fix_timestamp*1e3).format("DD.MM.YYYY")}`,label:"Сумма",bgSrc:V,buttonLabel:"Оплатить",min:1,isAgreement:!1,onClick:(s,i)=>u(i,s,3,s)}):e.jsx(j,{title:"Рассрочка",smallTitle:"Рассрочка",label:"Кол-во акций",bgSrc:V,buttonLabel:"Взять в рассрочку",min:10,onClick:(s,i)=>u(s,i,3,s*a?.current_price)})]})]}),e.jsx(f,{onClose:B,modalRef:x,children:e.jsxs("div",{className:t.modal,children:[e.jsx("h5",{className:t.modalTitle,children:"Реквизиты для оплаты"}),e.jsx("div",{style:{maxWidth:"50%",margin:"0 auto"},children:e.jsx("img",{src:oe,style:{width:"100%",height:"auto"}})}),e.jsxs("div",{className:t.modalContainer,children:[w.map((s,i)=>e.jsx(Z,{label:s.label,text:s.text},i)),e.jsx(r,{onClick:Y,type:"primary",children:"Я оплатил"}),e.jsx("button",{onClick:q,children:"Скачать PDF с реквизитами"})]})]})}),e.jsx(f,{onClose:()=>x?.current?.open(),modalRef:k,children:e.jsxs("div",{className:t.modal,children:[e.jsx("h5",{className:t.modalTitle,children:"Прикрепите чек оплаты"}),e.jsxs("div",{className:t.modalContainer,children:[e.jsx("div",{className:t.modalImageLoader,children:e.jsx(ie,{onClear:()=>p(null),loaderRef:R,setFile:p})}),e.jsx(r,{disabled:!N,onClick:A,type:"primary",children:"Подтвердить оплату"})]})]})}),e.jsx(f,{big:!0,modalRef:g,children:e.jsxs("div",{className:t.docModal,children:[e.jsx("div",{className:t.doc,dangerouslySetInnerHTML:{__html:M}}),e.jsxs("div",{className:t.actionBtns,children:[e.jsx(r,{onClick:E,children:"Согласен"}),e.jsx(r,{onClick:()=>g?.current?.close(),type:"outlined",children:"Отмена"})]})]})}),e.jsx(f,{modalRef:v,children:e.jsxs("div",{className:t.needVerification,children:[e.jsx("h5",{className:t.needVerification__title,children:"Пройдите верификацию"}),e.jsx("p",{className:t.needVerification__descr,children:"Перед покупкой необходимо пройти верификацию"}),e.jsx(r,{onClick:()=>I("/profile/verification"),children:"Пройти"}),e.jsx(r,{onClick:()=>v?.current?.close(),type:"outlined",children:"Отмена"})]})})]})}export{Ye as default};
